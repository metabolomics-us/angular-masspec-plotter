{"version":3,"file":"masspec-plotter-lib.js","sources":["../../../projects/masspec-plotter-lib/src/lib/masspec-plotter-lib.component.ts","../../../projects/masspec-plotter-lib/src/lib/masspec-plotter-lib.module.ts","../../../projects/masspec-plotter-lib/src/public-api.ts","../../../projects/masspec-plotter-lib/src/masspec-plotter-lib.ts"],"sourcesContent":["import {Component, OnInit, OnChanges, SimpleChanges, Renderer2,ElementRef, Input} from '@angular/core';\n\ndeclare var $: any;\n\n@Component({\n  selector: 'lib-masspec-plotter-lib',\n  template: `\n    <div style=\"width: 100%; height: 100%; display: inline-block;\">\n      <div class=\"masspec\" style=\"width: 100%; height: 100%\"></div>\n    </div>\n  `\n})\nexport class MasspecPlotterLibComponent implements OnInit, OnChanges {\n  @Input() spectrum: string;\n  @Input() miniPlot: boolean;\n\n  // Added 2021/04/20\n  @Input() pmzMax: number;\n  @Input() truncate: boolean;\n\n  parsedData: any;\n  plot;\n  placeholder;\n\n  constructor(private el: ElementRef, private renderer: Renderer2) { }\n\n  ngOnChanges(changes: SimpleChanges) {\n\n    // Watch the data source for changes to spectrum or pmzMax\n    if (typeof this.plot !== 'undefined') {\n      if (changes.hasOwnProperty('spectrum') && typeof changes.spectrum !== 'undefined') {\n        this.parsedData = this.parseData(this.spectrum);\n        this.redrawPlot();\n      } else if (changes.hasOwnProperty('pmzMax') && typeof changes.pmzMax !== 'undefined' && this.spectrum) {\n        // No need to parse data again if adjusting x-axis\n        this.redrawPlot();\n      }\n    }\n  }\n\n  ngOnInit(): void {\n    this.initializePlot();\n  }\n\n  computePlotLimits(data: any[]) {\n    let mzMax: number;\n    if (this.pmzMax !== undefined) {\n      mzMax = this.pmzMax;\n    } else {\n      mzMax = Math.max.apply(Math, data.map(x => x[0]));\n    }\n    const intensityMax = Math.max.apply(Math, data.map(x => x[1]));\n    return [mzMax, intensityMax];\n  }\n\n  initializePlot() {\n    this.parsedData = this.parseData(this.spectrum);\n    let data = this.parsedData.data;\n    const annotations = this.parsedData.annotations;\n\n    // Compute plot limits\n    let [mzMax, intensityMax] = this.computePlotLimits(data);\n\n    // Base options\n    const options: any = {\n      series: {\n        color: '#00f',\n        lines: {show: true, lineWidth: 0.5},\n        shadowSize: 0\n      },\n\n      grid: {\n        labelMargin: 15,\n\n        backgroundColor: '#fff',\n        color: '#e2e6e9',\n\n        borderWidth: {top: 0, right: 0, bottom: 1, left: 1},\n        borderColor: null\n      },\n\n      legend: {show: false}\n    };\n\n    // Format plot if a thumbnail version is desired\n    if (typeof this.miniPlot !== 'undefined') {\n      // Remove tick labels and set plot limits\n      options.xaxis = {min: 0, max: Math.max(1.05 * mzMax, 500), ticks: false};\n      options.yaxis = {min: 0, max: intensityMax, ticks: false};\n\n      // Filter low intensity peaks\n      data = data.filter(x => x[1] > 0.05 * intensityMax);\n    }\n\n    // Otherwise, set up plot selection zoom and tooltips\n    else {\n      // Set up plot limits\n      options.xaxis = {min: 0, max: 1.05 * mzMax};\n      options.yaxis = {min: 0, max: intensityMax};\n\n      // Set plot selection mode\n      options.selection = {mode: 'x'};\n\n      // Set hoverable plot properties\n      options.grid.hoverable = true;\n      options.grid.mouseActiveRadius = 10;\n    }\n\n    // Find placeholder element and plot the mass spectrum\n    const plotData = data.map(x => ({data: [[x[0], 0], x], lines: {show: true, lineWidth: 0.75}}));\n\n    const containerId: string = this.el.nativeElement.id;\n    this.placeholder = $('#' + containerId).find('.masspec');\n    this.plot = $.plot(this.placeholder, plotData, options);\n\n\n    // Set up interactivity if this is a full plot\n    if (typeof this.miniPlot === 'undefined') {\n      // Plot annotations\n      this.plotAnnotations();\n\n      // Define selection zoom functionality\n      this.placeholder.bind('plotselected', (event, range) => {\n        // Get maximum intensity in given range\n        const maxLocalIntensity = this.maxIntensityInRange(data, range.xaxis.from, range.xaxis.to);\n\n        // Set x-axis range\n        $.each(this.plot.getXAxes(), (_, axis) => {\n          axis.options.min = range.xaxis.from;\n          axis.options.max = range.xaxis.to;\n        });\n\n        // Set y-axis range\n        $.each(this.plot.getYAxes(), (_, axis) => {\n          axis.options.min = 0;\n          axis.options.max = maxLocalIntensity;\n        });\n\n        // Redraw plot\n        this.plot.setupGrid();\n        this.plot.draw();\n        this.plot.clearSelection();\n        this.plotAnnotations();\n      });\n\n      // Add button to reset selection zooming\n      $('<div><i class=\"fa fa-arrows-alt fa-2x\"></i></div>').css({\n        position: 'absolute',\n        top: '10px',\n        right: '10px',\n        cursor: 'pointer',\n        'font-size': 'smaller',\n        color: '#000',\n        // 'background-color': '#eee',\n        padding: '2px'\n      }).appendTo(this.placeholder).click((event) => {\n        event.preventDefault();\n        this.redrawPlot();\n      });\n\n\n      // Define functionality for plot hover / tooltips\n      this.placeholder.bind('plothover', (event, pos, item) => {\n        const showTooltip = (contents) => {\n          $('canvas').css('cursor', 'pointer');\n\n          const p = this.plot.pointOffset({x: pos.x, y: pos.y});\n\n          $('<div id=\"masspec-tooltip\">' + contents + '</div>').css({\n            position: 'absolute',\n            top: p.top + 5,\n            left: p.left + 5,\n            'font-size': 'smaller',\n            background: '#fff',\n            'z-index': '1040',\n            padding: '0.4em 0.6em',\n            'border-radius': '0.5em',\n            border: '1px solid #111',\n            'white-space': 'nowrap'\n          }).appendTo(this.placeholder);\n        };\n\n\n        // Remove current tooltip and highlight\n        $('#masspec-tooltip').remove();\n        $('canvas').css('cursor', 'auto');\n        this.plot.unhighlight();\n\n\n        // If datapoint is selected, show the tooltip\n        if (item) {\n          showTooltip('m/z = ' + item.datapoint[0] + '<br />abundance = ' + item.datapoint[1]);\n        }\n\n        // Otherwise, check if line being hovered over\n        else {\n          // Find nearest ion\n          const nearestIon: any = {\n            dist: -1\n          };\n\n          const cursor = this.plot.pointOffset({x: pos.x, y: pos.y});\n\n          $.each(data, (i, x) => {\n            const p = this.plot.pointOffset({x: x[0], y: x[1]});\n\n            if (nearestIon.dist === -1 ||\n              (Math.abs(p.left - cursor.left) < nearestIon.dist && pos.y > 0 && pos.y < x[1])) {\n              nearestIon.dist = Math.abs(p.left - cursor.left);\n              nearestIon.i = i;\n              nearestIon.datapoint = x;\n            }\n          });\n\n          // Set tooltip if we are near an ion peak\n          if (nearestIon.dist !== -1 && nearestIon.dist < this.plot.getOptions().grid.mouseActiveRadius) {\n            showTooltip('m/z = ' + nearestIon.datapoint[0] + '<br />abundance = ' + nearestIon.datapoint[1]);\n          }\n        }\n      });\n\n      // Replot annotations when window is resized\n      this.placeholder.resize(() => this.plotAnnotations());\n    }\n  }\n\n  redrawPlot() {\n    const plotData = this.parsedData.data.map(x => ({data: [[x[0], 0], x], lines: {show: true, lineWidth: 0.75}}));\n    this.plot.setData(plotData);\n\n    // Compute plot limits\n    let [mzMax, intensityMax] = this.computePlotLimits(this.parsedData.data);\n\n    // Reset x-axis range\n    $.each(this.plot.getXAxes(), (_, axis) => {\n      axis.options.min = 0;\n      axis.options.max = 1.05 * mzMax;\n    });\n\n    // Reset y-axis range\n    $.each(this.plot.getYAxes(), (_, axis) => {\n      axis.options.min = 0;\n      axis.options.max = intensityMax;\n    });\n\n    // Redraw plot\n    this.plot.setupGrid();\n    this.plot.draw();\n    this.plot.clearSelection();\n\n    if (typeof this.miniPlot === 'undefined') {\n      this.plotAnnotations();\n    }\n  }\n\n  /**\n   * Add annotations for the top n ions\n   * @param data spectrum data\n   * @param plot plot element\n   * @param placeholder placeholder element\n   * @param n number of top ions\n   */\n  plotAnnotations(n = 3) {\n    // Remove all annotation elements\n    $('.masspec-annotation').remove();\n\n    // Add annotations\n    for (const peak of this.getTopPeaks(this.parsedData.data, this.plot, n)) {\n      const p = this.plot.pointOffset({x: peak[0], y: peak[1]});\n\n      // Place annotation and then reposition to center on ion\n      const annotation = $('<div class=\"masspec-annotation\">' + peak[0] + '</div>').css({\n        position: 'absolute',\n        top: p.top - 12,\n        color: '#f00',\n        'font-size': 'x-small',\n        'text-align': 'center'\n      });\n      annotation.appendTo(this.placeholder);\n      annotation.css({left: p.left - annotation.width() / 2});\n    }\n  }\n\n  /**\n   * Find the maximum intensity in the given range+\n   * @param data plot data\n   * @param min minimum m/z\n   * @param max maximum m/z\n   */\n  maxIntensityInRange(data, min, max) {\n    let maxLocalIntensity = 0;\n\n    for (const x of data) {\n      if (x[0] >= max) {\n        break;\n      }\n\n      else if (x[0] >= min && x[1] >= maxLocalIntensity) {\n        maxLocalIntensity = x[1];\n      }\n    }\n\n    return Math.max(maxLocalIntensity, 0.1);\n  }\n\n  /**\n   * Find the n ions with the highest intensity in the given range\n   * @param data spectrum data\n   * @param plot plot object\n   * @param n number of highest intensity ions\n   */\n  getTopPeaks(data, plot, n = 3) {\n    // Get plot minimum and maximum\n    const min = plot.getXAxes()[0].options.min;\n    const max = plot.getXAxes()[0].options.max;\n\n    // Get data within range and sort by decreasing intensity\n    const reducedData = data.filter(x => min <= x[0] && x[0] <= max);\n    reducedData.sort((a, b) => b[1] - a[1]);\n\n    // Return the top n hits\n    return reducedData.slice(0, n);\n  }\n\n  /**\n   * Parse data into a plottable format\n   * @param originalData spectrum data\n   */\n  parseData(originalData) {\n    let data = [];\n    const annotations = [];\n\n    // Parse data if it is in the standard string format\n    if (typeof originalData === 'string') {\n      data = originalData.split(' ').map(x => x.split(':').map(Number));\n    }\n\n    // Check that the data is in a readable form already\n    else if (Array.isArray(originalData) && originalData.length > 0 && Array.isArray(originalData[0])) {\n      data = originalData;\n    }\n\n    // Reduce the object-form of the mass spectrum\n    else if (Array.isArray(originalData) && originalData.length > 0 && typeof originalData[0] === 'object') {\n      originalData.forEach(x => {\n        if (typeof x.selected === 'undefined' || x.selected === true) {\n          data.push([x.ion, x.intensity]);\n\n          if (x.annotation && x.annotation !== '') {\n            annotations.push([x.ion, x.annotation]);\n          }\n        }\n      });\n    }\n\n    if (data.length > 1000) {\n      data.sort((a, b) => b[1] - a[1]);\n      data = data.slice(0, 1000);\n    }\n\n    // Sort data by m/z\n    data.sort((a, b) => a[0] - b[0]);\n\n    data = this.truncate ? data.map(x => [Number(x[0].toFixed(4)), Number(x[1].toFixed(2))]) : data;\n\n    // Return parsed data\n    return {data, annotations};\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { MasspecPlotterLibComponent } from './masspec-plotter-lib.component';\n\n\n\n@NgModule({\n  declarations: [MasspecPlotterLibComponent],\n  imports: [\n  ],\n  exports: [MasspecPlotterLibComponent]\n})\nexport class MasspecPlotterLibModule { }\n","/*\n * Public API Surface of masspec-plotter-lib\n */\n\nexport * from './lib/masspec-plotter-lib.component';\nexport * from './lib/masspec-plotter-lib.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i0.ɵɵelementStart","i0.ɵɵelement","i0.ɵɵelementEnd"],"mappings":"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"}